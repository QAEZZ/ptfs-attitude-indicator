<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Attitude Indicator for PTFS</title>
    <link rel="stylesheet" href="assets/main.css" />
</head>

<body>
    <main>
        <div style="position:absolute; top:0;left:0;color:red;z-index:9999">
            <span id="x"></span>
            <span id="y"></span>
            <span id="py"></span>
            <span id="px"></span>
        </div>
        <div id="overlay">
            <div id="container">
                <div id="sky">
                    <div class="angles">
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <!-- <p>——</p>
                        <p>—</p>
                        <p>——</p>
                        <p>—</p>
                        <p>——</p>
                        <p>—</p>
                        <p>——</p>
                        <p>—</p> -->
                    </div>
                </div>
                <div id="ground">
                    <div class="angles">
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <p>—</p>
                        <!-- <p>—</p>
                        <p>——</p>
                        <p>—</p>
                        <p>——</p>
                        <p>—</p>
                        <p>——</p>
                        <p>—</p>
                        <p>——</p> -->
                    </div>
                </div>
            </div>
            <div id="horizontal-line">
                <div id="left-bar">
                </div>
                <div id="middle-dot"></div>
                <div id="right-bar">
                </div>
            </div>

        </div>
    </main>

    <!-- <script src="mouse.js"></script> -->
    <script src="app://dynamic.js"></script>

    <script>
        // function callDotNet() {
        //     window.external.sendMessage('Hi .NET! 🤖');
        // }

        // window.external.receiveMessage(message => alert(message));

        const sleep = ms => new Promise(r => setTimeout(r, ms));

        const labelX = document.getElementById('x');
        const labelY = document.getElementById('y');
        const labelPY = document.getElementById('py');
        const labelPX = document.getElementById('px');

        const sky = document.getElementById('sky');
        const ground = document.getElementById('ground');
        const horizon = document.getElementById('horizon');
        const container = document.getElementById('container');

        window.external.receiveMessage(message => {
            console.log(message);
            message = JSON.parse(message);
            if (message.msg === "mousePos") {
                labelX.textContent = message.data.x
                labelY.textContent = message.data.y

                const sensitivityY = 25;
                const sensitivityX = 15;

                const pY = (message.data.y / window.innerHeight) * sensitivityY;
                labelPY.textContent = Math.round(pY);

                const pX = (message.data.x / window.innerWidth) * sensitivityX;
                labelPX.textContent = Math.round(pX);

                sky.style.height = `calc(${pY}% + 50vh - 4px)`;
                ground.style.height = `calc(-${pY}% + 100vh)`;

                // ground.style.transformOrigin = 'top top';
                // ground.style.transform = `rotateZ(${pX}deg)`;
                container.style.transform = `rotateZ(${pX}deg)`;
                horizon.style.transform = `rotateZ(${pX}deg)`

            } else {
                alert("unknown message recieved.");
            }
        });

        (async () => {
            while (true) {
                window.external.sendMessage('getMousePos');
                await sleep(50);
            }
        })();



    </script>
</body>

</html>